[
    {
        "created": "20210608065533533",
        "creator": "Jacques",
        "text": "# Flashing Asus 2008 PIKE to IT Mode\n\n[Source](https://gist.github.com/pjobson/9ec25f7fc991f28d132ca813ab1bd541)\n\nUsed on an Asus Z8PE-D18 board with no EFI boot options.  These instructions were written using Linux Mint to create the media, most distributions will work with little modification.\n\nThe PIKE 2008 is basically a LSI 9220-8i which you can flash with 9211-8i firmware.  Flashing to IT mode allows you to have direct access to the disks to use `btrfs` or `zfs` or some kind of software RAID instead of the card's RAID.\n\n## Get Your SAS Address\n\nThere is a sticker on the back of your PIKE card which has 16 digits starting with `5000`.  Write this address down or take a picture of it.  Note I put `XXXXXXXXXXXX` in this picture as these numbers are unique to the card.  If your card does not have this sticker, instructions will be provided below.\n\n![SAS Address](https://gist.githubusercontent.com/pjobson/9ec25f7fc991f28d132ca813ab1bd541/raw/f840edcd5ff16b78adb359ca7fecbbcc1859a61e/zPIKE_2008.jpg)\n\n## Download FreeDOS\n\n    wget http://www.freedos.org/download/download/FD12FULL.zip\n\n### Unzip It\n\n    unzip FD12FULL.zip\n\n## USB\n\n### Insert and Find Your USB Stick\n\nThis will show a list of your drives, be sure to use the correct one.  I've put `/dev/xxx` in the instructions as the USB, yours will be different.\n\n    fdisk -l\n\nIt'll show something like this for your USB stick, note the drive size.\n\n    Disk /dev/xxx: 28.9 GiB, 30992891904 bytes, 60532992 sectors\n    Units: sectors of 1 * 512 = 512 bytes\n    Sector size (logical/physical): 512 bytes / 512 bytes\n    I/O size (minimum/optimal): 512 bytes / 512 bytes\n    Disklabel type: dos\n    Disk identifier: 0xd06a3fac\n\n### Unmount your USB\n\n    sudo umount /dev/xxx*\n\n### Write FreeDOS to USB\n\n    sudo dd if=FD12FULL.img of=/dev/xxx\n\n### Add Extended & Logical Partitions to Your USB\n\n    sudo fdisk /dev/xxx\n\n#### Print your partition table.\n\n    Command (m for help): p\n\n#### Should show something like this.\n\n    Disk /dev/xxx: 28.9 GiB, 30992891904 bytes, 60532992 sectors\n    Units: sectors of 1 * 512 = 512 bytes\n    Sector size (logical/physical): 512 bytes / 512 bytes\n    I/O size (minimum/optimal): 512 bytes / 512 bytes\n    Disklabel type: dos\n    Disk identifier: 0xd06a3fac\n\n    Device     Boot Start     End Sectors   Size Id Type\n    /dev/xxx1  *       63 1048319 1048257 511.9M  6 FAT16\n\n#### Create an Extended Partition\n\n    Command (m for help): n\n    Partition type\n       p   primary (1 primary, 0 extended, 3 free)\n       e   extended (container for logical partitions)\n    Select (default p): e\n    Partition number (2-4, default 2): 2\n    First sector (1048320-60532991, default 1048576): 1048576\n    Last sector, +sectors or +size{K,M,G,T,P} (1048576-60532991, default 60532991): +512M\n\n#### Add a Logical Partition\n\n    Command (m for help): n\n    Partition type\n       p   primary (1 primary, 1 extended, 2 free)\n       l   logical (numbered from 5)\n    Select (default p): l\n\n    Adding logical partition 5\n    First sector (1050624-2097151, default 1050624): 1050624\n    Last sector, +sectors or +size{K,M,G,T,P} (1050624-2097151, default 2097151): 2097151\n\n#### Change The Partition Type to FAT16.\n\n    Command (m for help): t\n    Partition number (1,2,5, default 5): 5\n    Partition type (type L to list all types): 6\n\n#### Print Your Table - Should display something like this:\n\n    Command (m for help): p\n    Disk /dev/xxx: 28.9 GiB, 30992891904 bytes, 60532992 sectors\n    Units: sectors of 1 * 512 = 512 bytes\n    Sector size (logical/physical): 512 bytes / 512 bytes\n    I/O size (minimum/optimal): 512 bytes / 512 bytes\n    Disklabel type: dos\n    Disk identifier: 0xd06a3fac\n\n    Device     Boot   Start     End Sectors   Size Id Type\n    /dev/xxx1  *         63 1048319 1048257 511.9M  6 FAT16\n    /dev/xxx2       1048576 2097151 1048576   512M  5 Extended\n    /dev/xxx5       1050624 2097151 1046528   511M  6 FAT16\n\n#### Write Your Partition Table\n\n    Command (m for help): w\n    The partition table has been altered.\n    Calling ioctl() to re-read partition table.\n    Syncing disks.\n\nThis will drop you back to the `bash` shell.\n\n### Format The Partition\n\n    sudo mkfs.fat /dev/xxx5\n\n### Label Your Partition\n\n    sudo fatlabel /dev/xxx5 SAS\n\n### Re-Mount USB\n\nThe most convenient way to do this is unplug it and plug it back in.\n\n## SAS Flash\n\n### Download and Unzip SAS Flash Files\n\n    wget https://gist.github.com/pjobson/9ec25f7fc991f28d132ca813ab1bd541/raw/4468546bfaa499d05a9f244cbcce6a200b1b62e0/sas_flash_files.zip\n    unzip sas_flash_files.zip\n\n### Copy Flash Files to USB\n\n    cp megarec.exe /media/_your_user_name_/SAS/\n    cp sas2flsh.exe /media/_your_user_name_/SAS/\n    cp 2118it.bin /media/_your_user_name_/SAS/\n    cp mptsas2.rom /media/_your_user_name_/SAS/\n    cp dos4gw.exe /media/_your_user_name_/SAS/\n    cp sbrempty.bin /media/_your_user_name_/SAS/\n\n### Disconnect All Drives and Reboot from the USB\n\nYou'll want to unplug all of your SAS and SATA drives and reboot with the USB only.  Remove any additional SAS cards if you have any.\n\n### FreeDOS Shell\n\nLet FreeDOS boot. Then Select:\n\n* `Install to harddisk`\n* `English`\n* `No - Return to DOS`\n\n### Go To Your D: Drive\n\n    D:\n    dir\n\nYou should see the exe files and rom files.\n\n### Get Your SAS Address\n\nIf you do not have the sticker as shown in Step 1, you can use `sas2flsh` to get the address.  Otherwise, you can skip this step.\n\n    sas2flsh.exe -c 0 -list\n\nShould display something like this:\n\n    Adapter Selected is a LSI SAS: SAS2008(B2)\n\n    Controller Number  : 0\n    Controller  : SAS2008(B2)\n    PCI Address  : 00:01:00:00\n    SAS Address  : 5000xxx-x-xxxx-xxxx\n    NVDATA Version (Default)  : 14.01.00.08\n    NVDATA Version (Persistent)  : 14.01.00.08\n    Firmware Product ID  : 0x2213 (IT)\n    Firmware Version  : 20.00.07.00\n    NVDATA Vendor  : LSI\n    NVDATA Product ID  : SAS9211-8i\n    BIOS Version  : N/A\n    UEFI BSD Version  : N/A\n    FCODE Version  : N/A\n    Board Name  : SAS9211-8i\n    Board Assembly  : N/A\n    Board Tracer Number  : N/A\n\n    Finished Processing Commands Successfully.\n    Exiting SAS2Flash.\n\n  Note the `SAS Address` this is what you need without the dashes, don't loose it.\n\n### Back-Up Your Card\n\n    megarec.exe -readsbr 0 pike2008.sbr\n\n### Wipe Your Card\n\n    megarec.exe -writesbr 0 sbrempty.bin\n    megarec.exe -cleanflash 0\n\n### Reboot\n\nYou will need to reboot here.\n\n### Back to D:\n\nAs shown above.\n\n### Flash IT Mode\n\n    sas2flsh.exe -o -f 2118it.bin -b mptsas2.rom\n\n### Restore Your SAS Address\n\nReplace `5000xxxxxxxxxxxx` with the one you hopefully wrote down.\n\n     sas2flsh.exe -o -sasadd 5000xxxxxxxxxxxx\n\n### List Card\n\n    sas2flsh.exe -listall\n\nThis should show your card and the firmware which you just flashed.\n\n## Additional Info: PIKE Card Chipset and Motherboard Reference\n\nHere is a reference for chipsets and motherboard support for various PIKE cards.  Check out the [LSI RAID Controller and HBA Complete Listing Plus OEM Models](https://forums.servethehome.com/index.php?threads/lsi-raid-controller-and-hba-complete-listing-plus-oem-models.599/) thread on ServeTheHome for more on RAID cards and flashing options.\n\n* [PIKE 1064E](https://www.asus.com/Commercial-Servers-Workstations/PIKE_1064E/) → LSI SAS 1064E\n\t* [Z8PE-D18](https://www.asus.com/Commercial-Servers-Workstations/Z8PED18/)\n\t* [Z8NR-D12](https://www.asus.com/Commercial-Servers-Workstations/Z8NRD12/)\n\t* [Z8NA-D6](https://www.asus.com/Commercial-Servers-Workstations/Z8NAD6/)\n\t* [P7F-E](https://www.asus.com/Commercial-Servers-Workstations/P7FE/)\n\t* [DSAN-DX](https://www.asus.com/us/Commercial-Servers-Workstations/DSANDX/)\n\t* [KGPE-D16](https://www.asus.com/Commercial-Servers-Workstations/KGPED16/)\n\t* [KFSN5-D/IST](https://www.asus.com/Commercial-Servers-Workstations/KFSN5DIST/)\n* [PIKE 1068E](https://www.asus.com/Commercial-Servers-Workstations/PIKE_1068E/) → LSI SAS 1068E\n\t* [Z8PH-D12 SE/QDR](https://www.asus.com/Commercial-Servers-Workstations/Z8PHD12_SEQDR/)\n\t* [Z8PE-D18](https://www.asus.com/Commercial-Servers-Workstations/Z8PED18/)\n\t* [Z8PE-D12X](https://www.asus.com/Commercial-Servers-Workstations/Z8PED12X/)\n\t* [Z8PE-D12](https://www.asus.com/Commercial-Servers-Workstations/Z8PED12/)\n\t* [Z8NR-D12](https://www.asus.com/Commercial-Servers-Workstations/Z8NRD12/)\n\t* [Z8NA-D6](https://www.asus.com/Commercial-Servers-Workstations/Z8NAD6/)\n\t* [P7F-E](https://www.asus.com/Commercial-Servers-Workstations/P7FE/)\n\t* [DSAN-DX](https://www.asus.com/us/Commercial-Servers-Workstations/DSANDX/)\n\t* [KGPE-D16](https://www.asus.com/Commercial-Servers-Workstations/KGPED16/)\n* [PIKE 1078](https://www.asus.com/Commercial-Servers-Workstations/PIKE_1078/) → LSI SAS 1078\n\t* [Z8PH-D12 SE/QDR](https://www.asus.com/Commercial-Servers-Workstations/Z8PHD12_SEQDR/)\n\t* [Z8PE-D18](https://www.asus.com/Commercial-Servers-Workstations/Z8PED18/)\n\t* [Z8PE-D12](https://www.asus.com/Commercial-Servers-Workstations/Z8PED12/)\n\t* [Z8PE-D12X](https://www.asus.com/Commercial-Servers-Workstations/Z8PED12X/)\n\t* [Z8NR-D12](https://www.asus.com/Commercial-Servers-Workstations/Z8NRD12/)\n\t* [Z8NA-D6](https://www.asus.com/Commercial-Servers-Workstations/Z8NAD6/)\n\t* [P7F-E](https://www.asus.com/Commercial-Servers-Workstations/P7FE/)\n\t* [DSAN-DX](https://www.asus.com/us/Commercial-Servers-Workstations/DSANDX/)\n\t* [KGPE-D16](https://www.asus.com/Commercial-Servers-Workstations/KGPED16/)\n\t* [KFSN5-D/IST](https://www.asus.com/Commercial-Servers-Workstations/KFSN5DIST/)\n* [PIKE 2008](https://www.asus.com/us/Commercial-Servers-Workstations/PIKE_2008/) → LSI SAS 2008\n\t* [Z8PH-D12 SE/QDR](https://www.asus.com/Commercial-Servers-Workstations/Z8PHD12_SEQDR/)\n\t* [Z8PH-D12/IFB](https://www.asus.com/Commercial-Servers-Workstations/Z8PHD12IFB/)\n\t* [Z8PE-D18](https://www.asus.com/Commercial-Servers-Workstations/Z8PED18/)\n\t* [Z8PE-D12X](https://www.asus.com/Commercial-Servers-Workstations/Z8PED12X/)\n\t* [Z8PE-D12](https://www.asus.com/Commercial-Servers-Workstations/Z8PED12/)\n\t* [Z8NR-D12](https://www.asus.com/Commercial-Servers-Workstations/Z8NRD12/)\n\t* [Z8NH-D12](https://www.asus.com/Commercial-Servers-Workstations/Z8NHD12/)\n\t* [Z8NA-D6](https://www.asus.com/Commercial-Servers-Workstations/Z8NAD6/)\n\t* [P7F-E](https://www.asus.com/Commercial-Servers-Workstations/P7FE/)\n\t* [KGPE-D16](https://www.asus.com/us/Commercial-Servers-Workstations/KGPED16/)\n* [PIKE 2108](https://www.asus.com/us/Commercial-Servers-Workstations/PIKE_2108/) → LSI SAS 2108\n\t* Intel P9 Series\n\t* Z9 Series\n\t* P8 Series\n\t* Z8 Series with PIKE slot\n\t* AMD KG Series\n\t* KC Series with PIKE slot\n* [PIKE 2208](https://www.asus.com/us/Commercial-Servers-Workstations/PIKE_2208/) → LSI SAS 2208\n\t* Intel P9 Series\n\t* Z9 Series\n\t* P8 Series\n\t* Z8 Series with PIKE slot\n\t* AMD KG Series\n\t* KC Series with PIKE slot\n* [PIKE 2308](https://www.asus.com/us/Commercial-Servers-Workstations/PIKE_2308/) → LSI SAS 2308\n\t* Intel P9 Series\n\t* Z9 Series\n\t* P8 Series\n\t* Z8 Series with PIKE slot\n\t* AMD KG Series\n\t* KC Series with PIKE slot\n* [PIKE 6480](https://www.asus.com/Commercial-Servers-Workstations/PIKE_6480/) → Marvell 88SE6480\n\t* [Z8PE-D18](https://www.asus.com/Commercial-Servers-Workstations/Z8PED18/)\n\t* [Z8PE-D12X](https://www.asus.com/Commercial-Servers-Workstations/Z8PED12X/)\n\t* [Z8PE-D12](https://www.asus.com/Commercial-Servers-Workstations/Z8PED12/)\n\t* [Z8NR-D12](https://www.asus.com/Commercial-Servers-Workstations/Z8NRD12/)\n\t* [Z8NA-D6](https://www.asus.com/Commercial-Servers-Workstations/Z8NAD6/)\n\t* [P7F-E](https://www.asus.com/Commercial-Servers-Workstations/P7FE/)\n\t* [DSAN-DX](https://www.asus.com/us/Commercial-Servers-Workstations/DSANDX/)\n\t* [KGPE-D16](https://www.asus.com/Commercial-Servers-Workstations/KGPED16/)\n* [PIKE 9230](https://www.asus.com/Commercial-Servers-Workstations/PIKE_9230/) → Marvell 88SE9230\n\t* Intel P9 Series\n\t* Z9 Series\n\t* P8 Series\n\t* Z8 Series with PIKE slot\n\t* AMD KG Series\n\t* KC Series with PIKE slot\n* [PIKE II 3008-8i](https://www.asus.com/us/Commercial-Servers-Workstations/PIKE_II_30088i/) → Broadcom (LSI) SAS3008\n\t* [ESC4000 G3](https://www.asus.com/Commercial-Servers-Workstations/ESC4000_G3/)\n\t* [ESC4000 G3S](https://www.asus.com/Commercial-Servers-Workstations/ESC4000_G3S/)\n\t* [ESC8000 G3](https://www.asus.com/us/Commercial-Servers-Workstations/ESC8000_G3/)\n\t* [P9A-I](https://www.asus.com/us/Commercial-Servers-Workstations/P9AIC2750SAS4L/)\n\t* [P9D-C/4L](https://www.asus.com/us/Commercial-Servers-Workstations/P9DC4L/)\n\t* [P9D-E/4L](https://www.asus.com/Commercial-Servers-Workstations/P9DE4L/)\n\t* [P9D-I](https://www.asus.com/us/Commercial-Servers-Workstations/P9DI/)\n\t* P9D-IV\n\t* [P9D-M](https://www.asus.com/Commercial-Servers-Workstations/P9DM/)\n\t* [P9D-MH](https://www.asus.com/us/Commercial-Servers-Workstations/P9DMHSAS10GDUAL/)\n\t* [P9D-MV](https://www.asus.com/Commercial-Servers-Workstations/P9DMV/)\n\t* [P9D-V](https://www.asus.com/us/Commercial-Servers-Workstations/P9DV/)\n\t* [P9D-X](https://www.asus.com/Commercial-Servers-Workstations/P9DX/)\n\t* [RS500-E8](https://www.asus.com/Commercial-Servers-Workstations/RS500E8PS4/)\n\t* [RS520-E8](https://www.asus.com/Commercial-Servers-Workstations/RS520E8RS8/)\n\t* [RS700-E7](https://www.asus.com/us/Commercial-Servers-Workstations/RS700E7RS8/)\n\t* [RS700-E8](https://www.asus.com/us/Commercial-Servers-Workstations/RS700E7RS8/)\n\t* [RS720-E7/RS12](https://www.asus.com/Commercial-Servers-Workstations/RS720E7RS12/)\n\t* [RS720-E7/RS24-EG](https://www.asus.com/me-en/Commercial-Servers-Workstations/RS720E7RS24EG/)\n\t* [RS720-E8-RS24-E](https://www.asus.com/Commercial-Servers-Workstations/RS720E8RS24E/)\n\t* [RS720Q-E7/RS12](https://www.asus.com/Commercial-Servers-Workstations/RS720QE7RS12/)\n\t* [RS720Q-E8-RS12](https://www.asus.com/us/Commercial-Servers-Workstations/RS720QE8RS12/)\n\t* [TS500-E8-PS4](https://www.asus.com/Commercial-Servers-Workstations/TS500-E8-PS4-V2/)\n\t* [TS700-E7/RS8](https://www.asus.com/us/Commercial-Servers-Workstations/TS700E7RS8/)\n\t* [TS700-E8](https://www.asus.com/us/Commercial-Servers-Workstations/TS700-E8-RS8-V2/)\n\t* [TS700-X7/PS4](https://www.asus.com/us/Commercial-Servers-Workstations/TS700X7PS4/)\n\t* [X99-E WS](https://www.asus.com/Motherboards/X99E_WS/)\n\t* [Z10PA-D8](https://www.asus.com/us/Commercial-Servers-Workstations/Z10PAD8/)\n\t* [Z10PA-U8](https://www.asus.com/Commercial-Servers-Workstations/Z10PAU8/)\n\t* [Z10PE-D16](https://www.asus.com/us/Commercial-Servers-Workstations/Z10PED16/)\n\t* [Z10PE-D16 WS](https://www.asus.com/us/Motherboards/Z10PED16_WS/)\n\t* [Z10PE-D8 WS](https://www.asus.com/us/Motherboards/Z10PED8_WS/)\n\t* [Z10PH-D16](https://www.asus.com/us/Commercial-Servers-Workstations/Z10PHD16/)\n\t* [Z10PR-D16](https://www.asus.com/Commercial-Servers-Workstations/Z10PRD16/)\n\t* [Z9NA-D6](https://www.asus.com/us/Commercial-Servers-Workstations/Z9NAD6/)\n\t* [Z9NH-D12](https://www.asus.com/Commercial-Servers-Workstations/Z9NHD12/)\n\t* [Z9NR-D12](https://www.asus.com/Commercial-Servers-Workstations/Z9NRD12/)\n\t* [Z9PA-D8](https://www.asus.com/us/Commercial-Servers-Workstations/Z9PAD8/)\n\t* [Z9PA-U8](https://www.asus.com/Commercial-Servers-Workstations/Z9PAU8/)\n\t* [Z9PE-D16](https://www.asus.com/Commercial-Servers-Workstations/Z9PED16/)\n\t* [Z9PE-D16-10G/DUAL](https://www.asus.com/me-en/Commercial-Servers-Workstations/Z9PED1610GDUAL/)\n\t* [Z9PE-D8 WS](https://www.asus.com/Motherboards/Z9PED8_WS/)\n\t* [Z9PH-D16](https://www.asus.com/us/Commercial-Servers-Workstations/Z9PHD16/)\n\t* [Z9PR-D12](https://www.asus.com/us/Commercial-Servers-Workstations/Z9PRD12/)\n\t* [Z9PR-D16](https://www.asus.com/Commercial-Servers-Workstations/Z9PRD16/)\n* [PIKE II 3108-8i/16PD](https://www.asus.com/us/Commercial-Servers-Workstations/PIKE_II_31088i16PD/) → Broadcom (LSI) SAS3108\n\t* This is really just an LSI RAID card with two internal Mini-SAS connectors.\n\t* I do not know if it works on non-Asus motherboards.\n* [PIKE II 3108-8i/16PD/2G](https://www.asus.com/Commercial-Servers-Workstations/PIKE-II-3108-8I-16PD-2G/) → Broadcom (LSI) SAS3108\n\t* This is really just an LSI RAID card with two internal Mini-SAS connectors.\n\t* I do not know if it works on non-Asus motherboards.\n* [PIKE II 3108-8i/240PD](https://www.asus.com/us/Commercial-Servers-Workstations/PIKE_II_31088i240PD/) → Broadcom (LSI) SAS3108\n\t* This is really just an LSI RAID card with two internal Mini-SAS connectors.\n\t* I do not know if it works on non-Asus motherboards.\n* [PIKE II 3108-8i/240PD/2G](https://www.asus.com/Commercial-Servers-Workstations/PIKE-II-3108-8I-240PD-2G/) → Broadcom (LSI) SAS3108\n\t* This is really just an LSI RAID card with two internal Mini-SAS connectors.\n\t* I do not know if it works on non-Asus motherboards.\n",
        "type": "text/x-markdown",
        "title": "Flashing Asus 2008 PIKE to IT Mode",
        "tags": "[[Server Environment]] solution",
        "modifier": "Jacques",
        "modified": "20210913080703353",
        "tmap.id": "681ae11c-d8a3-450b-9d97-3f9b636f7871",
        "url": "https://gist.github.com/pjobson/9ec25f7fc991f28d132ca813ab1bd541",
        "responder": " pjobson/pike_it"
    }
]